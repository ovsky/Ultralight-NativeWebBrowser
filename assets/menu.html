<html>

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="ui.css">
    <style>
        body {
            margin: 0;
            background: transparent;
        }

        /* Ensure the dropdown is fixed relative to the window */
        #menu-root {
            position: fixed;
            inset: 0;
        }

        #menu-dropdown {
            position: fixed;
            top: 40px;
            right: 10px;
        }
    </style>
</head>

<body>
    <div id="menu-root">
        <div id="menu-dropdown" class="menu-dropdown" role="menu" aria-hidden="false">
            <div class="menu-item" data-action="new-tab">New tab [Ctrl+T]</div>
            <div class="menu-item" data-action="new-window">New window [Ctrl+N]</div>
            <div class="menu-separator"></div>
            <div class="menu-item" id="toggle-dark" data-action="toggle-dark">Dark theme: Toggle</div>
            <div class="menu-separator"></div>
            <div class="menu-item" data-action="history">History [Ctrl+H]</div>
            <div class="menu-item" data-action="downloads">Downloads</div>
        </div>
    </div>

    <script>
        (function () {
            const root = document.getElementById('menu-root');
            const menu = document.getElementById('menu-dropdown');

            function closeMenu() {
                if (window.OnMenuClose) OnMenuClose();
            }

            // Click outside closes
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#menu-dropdown')) {
                    closeMenu();
                }
            });

            // ESC closes
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeMenu();
            });

            function refreshDarkLabel() {
                try {
                    if (window.GetDarkModeEnabled) {
                        const on = !!GetDarkModeEnabled();
                        const el = document.getElementById('toggle-dark');
                        if (el) el.textContent = 'Dark theme: ' + (on ? 'On' : 'Off');
                    }
                } catch { }
            }

            // Item clicks
            menu.addEventListener('click', (e) => {
                const item = e.target.closest('.menu-item');
                if (!item) return;
                const action = item.getAttribute('data-action');
                switch (action) {
                    case 'new-tab':
                        if (window.OnRequestNewTab) OnRequestNewTab();
                        break;
                    case 'new-window':
                        // Placeholder: open a new tab as "new window" is not implemented
                        if (window.OnRequestNewTab) OnRequestNewTab();
                        break;
                    case 'toggle-dark':
                        if (window.OnToggleDarkMode) OnToggleDarkMode();
                        break;
                    case 'history':
                        if (window.OnRequestChangeURL) OnRequestChangeURL('file:///history.html');
                        break;
                    case 'downloads':
                        if (window.OnRequestChangeURL) OnRequestChangeURL('file:///release_notes.html');
                        break;
                }
                closeMenu();
            });

            // Initialize labels
            refreshDarkLabel();
        })();
    </script>
</body>

</html>