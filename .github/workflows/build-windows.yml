# .github/workflows/windows-build.yml
#
# Builds the project on Windows (Visual Studio)
# This uses a multi-config generator, so the --config flag
# is used during the build step.

name: Build - Windows

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: '1. Checkout Code (with submodules)'
      uses: actions/checkout@v4
      with:
        submodules: 'recursive'

    - name: '2. Configure CMake'
      # No build type needed here; Visual Studio will handle it
      run: cmake -S . -B build

    - name: '3. Build Project'
      # We specify the 'Release' config at build time
      run: cmake --build build --config Release --parallel

    - name: '4. Archive Artifacts'
      # For multi-config, outputs are in a subfolder (e.g., 'build/bin/Release')
      # We use PowerShell's Compress-Archive
      run: |
        Compress-Archive -Path build\bin\Release\* -DestinationPath ultralight-windows.zip

    - name: '5. Upload Artifact'
      uses: actions/upload-artifact@v4
      with:
        name: ultralight-windows-build
        path: ultralight-windows.zip
