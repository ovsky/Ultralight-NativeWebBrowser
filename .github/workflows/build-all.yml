name: Build - All (x64 + ARM64)

on:
  workflow_dispatch:
    inputs:
      sdk_url:
        description: "Override ULTRALIGHT_SDK_URL (raw .7z in base-sdk branch)"
        required: false
        type: string
      version:
        description: "Override ULTRALIGHT_VERSION (eg. 1.4.0)"
        required: false
        type: string
      webbrowser_version:
        description: "Override build version name (default 'dev')"
        required: false
        type: string
      package_format:
        description: "Package format(s) for macOS/Linux (eg. TGZ;DMG or TGZ;DEB;RPM)"
        required: false
        type: string
      create_installer:
        description: "Create Windows installer via CPack (NSIS) when true"
        required: false
        type: boolean
        default: false
      development_build:
        description: "Development build (keeps intermediate packages, verbose logs)"
        required: false
        type: boolean
        default: false
  pull_request:

permissions:
  contents: read
  actions: write

jobs:
  windows:
    uses: ./.github/workflows/build-windows.yml
    secrets: inherit
    with:
      sdk_url: ${{ inputs.sdk_url || github.event.inputs.sdk_url }}
      version: ${{ inputs.version || github.event.inputs.version }}
      webbrowser_version: ${{ inputs.webbrowser_version || github.event.inputs.webbrowser_version }}
      development_build: ${{ inputs.development_build || github.event.inputs.development_build || false }}
      # create installer by default on PRs, otherwise obey input
      create_installer: ${{ inputs.create_installer || github.event_name == 'pull_request' }}

  macos-x64:
    uses: ./.github/workflows/build-macos.yml
    secrets: inherit
    with:
      sdk_url: ${{ inputs.sdk_url || github.event.inputs.sdk_url }}
      version: ${{ inputs.version || github.event.inputs.version }}
      webbrowser_version: ${{ inputs.webbrowser_version || github.event.inputs.webbrowser_version }}
      package_format: ${{ inputs.package_format || github.event.inputs.package_format }}
      development_build: ${{ inputs.development_build || github.event.inputs.development_build || false }}

  macos-arm64:
    uses: ./.github/workflows/build-macos-arm64.yml
    secrets: inherit
    with:
      sdk_url: ${{ inputs.sdk_url || github.event.inputs.sdk_url }}
      version: ${{ inputs.version || github.event.inputs.version }}
      webbrowser_version: ${{ inputs.webbrowser_version || github.event.inputs.webbrowser_version }}
      package_format: ${{ inputs.package_format || github.event.inputs.package_format }}
      development_build: ${{ inputs.development_build || github.event.inputs.development_build || false }}

  linux-x64:
    uses: ./.github/workflows/build-linux.yml
    secrets: inherit
    with:
      sdk_url: ${{ inputs.sdk_url || github.event.inputs.sdk_url }}
      version: ${{ inputs.version || github.event.inputs.version }}
      webbrowser_version: ${{ inputs.webbrowser_version || github.event.inputs.webbrowser_version }}
      package_format: ${{ inputs.package_format || github.event.inputs.package_format }}
      development_build: ${{ inputs.development_build || github.event.inputs.development_build || false }}

  linux-arm64:
    uses: ./.github/workflows/build-linux-arm64.yml
    secrets: inherit
    with:
      sdk_url: ${{ inputs.sdk_url || github.event.inputs.sdk_url }}
      version: ${{ inputs.version || github.event.inputs.version }}
      webbrowser_version: ${{ inputs.webbrowser_version || github.event.inputs.webbrowser_version }}
      package_format: ${{ inputs.package_format || github.event.inputs.package_format }}
      development_build: ${{ inputs.development_build || github.event.inputs.development_build || false }}
